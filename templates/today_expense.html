{% load i18n %}
{% load static %}
{% get_current_language as LANGUAGE_CODE %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>💸 {% trans "Bugungi chiqim" %}</title>
  <link rel="stylesheet" href="{% static 'css/today_expence.css' %}">
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
</head>
<body>

  {% if messages %}
  <div id="toast-container" style="position: fixed; top: 20px; right: 20px; z-index: 9999; width: 320px;">
    {% for message in messages %}
      <div 
        class="shadow-lg rounded-xl mb-3 text-white d-flex align-items-center" 
        style="
          padding: 12px 16px;
          {% if message.tags == 'success' %} background:#28a745; 
          {% elif message.tags == 'error' %} background:#dc3545; 
          {% elif message.tags == 'warning' %} background:#ffc107; color:#222;
          {% else %} background:#007bff;
          {% endif %}
        ">
        {% if message.tags == "success" %}
          ✅
        {% elif message.tags == "error" %}
          ❌
        {% elif message.tags == "warning" %}
          ⚠️
        {% else %}
          ℹ️
        {% endif %}
        <span class="ms-2">{{ message }}</span>
      </div>
    {% endfor %}
  </div>
{% endif %}

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo">💰 Finans</div>
    <nav>
      <a href="{% url "dashboard" %}"><i class='bx bx-grid-alt'></i> {% trans "Dashboard" %}</a>
      <a href="{% url "income" %}"><i class='bx bx-money'></i> {% trans "Bugungi kirim" %}</a>
      <a href="{% url "expence" %}" class="active"><i class='bx bx-bar-chart-alt-2'></i> {% trans "Bugungi chiqim" %}</a>
      <a href="{% url "category" %}"><i class='bx bx-category'></i> {% trans "Categorylar" %}</a>
    </nav>
  </aside>

  <!-- Main content -->
  <div class="main-content">
    <a href="/dashboard/" class="back-btn"><i class='bx bx-arrow-back'></i> {% trans "Orqaga" %}</a>
    
    <div class="expense-container">
      <h1>💸 {% trans "Bugungi chiqim" %}</h1>
      <p>{% trans "Bugungi chiqim summasini kiriting, category va izoh tanlang." %}</p>

      <!-- Form -->
      <form method="POST" action="">
        {% csrf_token %}
        <div class="input-group">
          <i class='bx bx-money'></i>
          <input type="number" name="amount" placeholder="{% trans 'Summani kiriting' %}" required>
        </div>

        <h3>{% trans "Category tanlang" %}</h3>
        <div class="categories">
          {% for category in categories %}
          <label class="category-card">
            <input type="radio" name="category" value="{{ category.id }}" required>
            <i class='{{ category.icon }}'></i>
            <span>{{ category.name }}</span>
          </label>
          {% endfor %}
        </div>

        <div class="input-group">
          <i class='bx bx-chat'></i>
          <input type="text" name="note" placeholder="{% trans 'Izoh yozing...' %}">
        </div>

        <button type="submit">{% trans "Saqlash" %}</button>
      </form>
    </div>

    <!-- Bugungi chiqimlar jadvali -->
    <div class="today-list">
      <h2>{% trans "Bugungi chiqimlar" %}</h2>
      <table>
        <thead>
          <tr>
            <th>{% trans "Sana" %}</th>
            <th>{% trans "Kategoriya" %}</th>
            <th>{% trans "Summa" %}</th>
            <th>{% trans "Izoh" %}</th>
          </tr>
        </thead>
        <tbody>
          {% for expense in today_expenses %}
          <tr>
            <td>{{ expense.date }}</td>
            <td><i class="{{ expense.category.icon }}"></i> {{ expense.category.name }}</td>
            <td class="expense">-{{ expense.amount|floatformat:2 }}</td>
            <td>{{ expense.note }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="4">{% trans "Bugungi chiqim mavjud emas" %}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

</body>
</html>
